<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rat Furniture</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

.header {
  background: #111;
  color: white;
  text-align: center;
  padding: 22px;
}

.catalog {
  padding: 15px;
}

.card {
  background: white;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
}

.card img {
  width: 100%;
  border-radius: 8px;
}

input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  margin-bottom: 6px;
}

.btn {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.save {
  background: #25D366;
  color: white;
  margin-top: 8px;
}

.delete {
  background: #c62828;
  color: white;
  margin-top: 8px;
}

.add {
  background: black;
  color: white;
  margin-top: 20px;
}
</style>
</head>

<body>

<div class="header">
  <h1 id="shopName">Rat Furniture</h1>
  <p>Scan. View. Order on WhatsApp.</p>
</div>

<div class="catalog" id="catalog"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDvWo9_TNzeHDMaWYMc2AuTHxC6vAcvF18",
  authDomain: "qr-catalog-65293.firebaseapp.com",
  projectId: "qr-catalog-65293",
  storageBucket: "qr-catalog-65293.firebasestorage.app",
  messagingSenderId: "268295648094",
  appId: "1:268295648094:web:75d6b5eb6080e79aee95cf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "catalog", "main");

let data;
const passkey = "29876104";

async function load() {
  const snap = await getDoc(ref);
  data = snap.data();
  render();
}

function render() {
  const c = document.getElementById("catalog");
  c.innerHTML = "";

  data.products.forEach((p, i) => {
    c.innerHTML += `
      <div class="card">
        <input value="${p.name}" id="name${i}">
        <input value="${p.price}" id="price${i}">
        <input value="${p.img}" placeholder="Image link" id="img${i}">
        <button class="btn save" onclick="save(${i})">Save</button>
        <button class="btn delete" onclick="remove(${i})">Delete</button>
      </div>
    `;
  });

  c.innerHTML += `
    <button class="btn add" onclick="add()">+ Add Product</button>
  `;
}

window.save = async (i) => {
  data.products[i] = {
    name: document.getElementById("name" + i).value,
    price: document.getElementById("price" + i).value,
    img: document.getElementById("img" + i).value || "https://picsum.photos/300"
  };

  await setDoc(ref, { ...data, passkey });
  alert("Saved");
};

window.add = async () => {
  data.products.push({
    name: "New Product",
    price: "0",
    img: "https://picsum.photos/300"
  });
  await setDoc(ref, { ...data, passkey });
  load();
};

window.remove = async (i) => {
  data.products.splice(i, 1);
  await setDoc(ref, { ...data, passkey });
  load();
};

load();
</script>

</body>
</html>
