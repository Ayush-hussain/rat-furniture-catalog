<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rat Furniture</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #111;
  --accent: #25D366;
  --bg: #f8f9fa;
  --card-bg: #ffffff;
  --text: #333;
}

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  padding-bottom: 90px;
}

.header {
  background: var(--primary);
  color: white;
  text-align: center;
  padding: 30px 20px;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
}

.container {
  max-width: 1000px;
  margin: auto;
  padding: 20px;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 15px;
}

.card {
  background: var(--card-bg);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}

.card img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
  background: #eee;
}

.card-content {
  padding: 12px;
}

.product-name {
  font-weight: 600;
}

.product-price {
  color: #666;
  margin-bottom: 10px;
}

.btn {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.btn-whatsapp {
  background: var(--accent);
  color: white;
  text-decoration: none;
  display: block;
  text-align: center;
}

.admin-controls {
  margin-top: 10px;
  display: none;
}

.admin-mode .admin-controls {
  display: block;
}

.admin-mode .btn-whatsapp {
  display: none;
}

input {
  width: 100%;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 6px;
  border: 1px solid #ddd;
}

.btn-save { background: #111; color: white; }
.btn-delete { background: #e53935; color: white; }

.btn-add {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #111;
  color: white;
  font-size: 28px;
  border: none;
}

.footer-bar {
  text-align: center;
  margin: 30px 0;
  color: #aaa;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="header">
  <h1>Rat Furniture</h1>
  <p>Scan. View. Order on WhatsApp.</p>
</div>

<div class="container">
  <div id="catalog" class="catalog-grid">
    Loadingâ€¦
  </div>
</div>

<button class="btn-add" onclick="addProduct()">+</button>

<div class="footer-bar" onclick="toggleAdmin()">ðŸ”’ Admin Access</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDvWo9_TNzeHDMaWYMc2AuTHxC6vAcvF18",
  authDomain: "qr-catalog-65293.firebaseapp.com",
  projectId: "qr-catalog-65293",
  storageBucket: "qr-catalog-65293.firebasestorage.app",
  messagingSenderId: "268295648094",
  appId: "1:268295648094:web:75d6b5eb6080e79aee95cf"
};

const PASSKEY = "29876104";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "catalog", "main");

let products = [];
let isAdmin = false;

onSnapshot(ref, snap => {
  if (snap.exists()) {
    products = snap.data().products || [];
    render();
  } else {
    setDoc(ref, {
      passkey: PASSKEY,
      products: []
    });
  }
});

function render() {
  document.body.classList.toggle("admin-mode", isAdmin);
  const c = document.getElementById("catalog");
  c.innerHTML = "";

  products.forEach((p, i) => {
    c.innerHTML += `
      <div class="card">
        <img src="${p.img}" onerror="this.src='https://placehold.co/300x300?text=No+Image'">
        <div class="card-content">
          <div class="product-name">${p.name}</div>
          <div class="product-price">â‚¹${p.price}</div>
          <a class="btn btn-whatsapp" href="https://wa.me/?text=Interested in ${encodeURIComponent(p.name)}">Order</a>

          <div class="admin-controls">
            <input id="n${i}" value="${p.name}">
            <input id="p${i}" value="${p.price}">
            <input id="i${i}" value="${p.img}" placeholder="Image URL">
            <button class="btn btn-save" onclick="save(${i})">Save</button>
            <button class="btn btn-delete" onclick="remove(${i})">Delete</button>
          </div>
        </div>
      </div>
    `;
  });
}

window.toggleAdmin = () => {
  if (isAdmin) {
    isAdmin = false;
    render();
    return;
  }
  const k = prompt("Enter admin passkey:");
  if (k === PASSKEY) {
    isAdmin = true;
    render();
  } else if (k) {
    alert("Wrong passkey");
  }
};

window.addProduct = async () => {
  products.push({
    name: "New Product",
    price: "0",
    img: "https://placehold.co/300x300?text=Image"
  });
  await sync();
};

window.save = async i => {
  products[i] = {
    name: document.getElementById(`n${i}`).value,
    price: document.getElementById(`p${i}`).value,
    img: document.getElementById(`i${i}`).value
  };
  await sync();
  alert("Saved");
};

window.remove = async i => {
  if (confirm("Delete this product?")) {
    products.splice(i, 1);
    await sync();
  }
};

async function sync() {
  await setDoc(ref, {
    passkey: PASSKEY,
    products
  });
}
</script>

</body>
</html>
